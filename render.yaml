services:
  # -------------------
  # MongoDB (Private)
  # -------------------
  - type: pserv
    name: mongo-db
    env: docker
    image: mongo:6
    plan: free
    disk:
      name: mongo-data
      mountPath: /data/db
      sizeGB: 1

  # -------------------
  # Backend API
  # -------------------
  - type: web
    name: node-backend
    env: docker
    rootDir: backend
    dockerfilePath: Dockerfile
    plan: free
    envVars:
      - key: PORT
        value: 5000
      - key: MONGODB_URI
        fromService:
          name: mongo-db
          type: pserv
          property: host
      - key: GEMINI_API_KEY
        sync: false

  # -------------------
  # Nginx Frontend Proxy
  # -------------------
  - type: web
    name: nginx-proxy
    env: docker
    dockerfilePath: nginx/Dockerfile
    plan: free
    dependsOn:
      - node-backend
